<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Cost Analytics</title>
        <link rel="stylesheet" type="text/css"
              href="https://fonts.googleapis.com/css?family=Open+Sans:400,600">
        <link rel="stylesheet" type="text/css" href="docs/css/sequences.css"/>

        <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css"/>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css"></script>
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
        <script src="http://d3js.org/d3.v3.js"></script>

        <link href="css/toastr.css" rel="stylesheet"/>

        <style type="text/css">

            .axis path,
            .axis line {
                fill: none;
                stroke: #000;
                shape-rendering: crispEdges;
            }

            .node circle {
                cursor: pointer;
                fill: #fff;
                stroke: steelblue;
                stroke-width: 1.5px;
            }

            .node text {
                font: 10px sans-serif;
            }

            path.link {
                fill: none;
                stroke: #ccc;
                stroke-dasharray: 3.3;
                stroke-width: 1.5px;
            }

            path.metricLink {
                fill: none;
                stroke: #A31E39;
                stroke-width: 3px;
            }

            #A{
                position:absolute;
                top:50%;
                left:50%;
            }

        </style>

    </head>
    <body> 

        <div id="main">
            <div id="mydialog"></div>
            <table style="width:100%">

                <tr>
                    <td>
                        <div id="treeView"></div>
                    </td>
                    <td>
                        <div id="wheelView"></div>
                    </td>
                </tr>
                <tr><td><div id="trailDiv"></div></td><td>&nbsp;</td></tr>
                <tr><td><div id="analytics"></div></td><td>&nbsp;</td></tr>


            </table>
        </div>

        <script type="text/javascript" >
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            var serviceID = vars[0];
        </script>


        <script type="text/javascript" src="docs/spin.js" ></script>
        <script type="text/javascript" src="docs/sequences.js"></script>

        <script type="text/javascript" src="melaTreeView.js"></script>

        <script type="text/javascript" >
//            d3.json("test.json", function (error, root) {
//                var json = root;
//                createVisualization(json, "wheelView", window.innerWidth / 3, 200, "trailDiv", "analytics");
//            });
        </script> 

        <script type="text/javascript" >
            setupTreeView(vars[0], "treeView", window.innerWidth * 2 / 3, window.innerHeight / 2, vars[1]);
//
//            d3.json("tree.json", function (error, root) {
//                var json = root;
//                updateTreeView(json);
//            });
        </script>


        <script type="text/javascript" >
            function refreshMonitoringDataTreeView() {
                reqMonitoringDataObject = null;
                if (window.XMLHttpRequest) {
                    reqMonitoringDataObject = new XMLHttpRequest();
                } else {
                    reqMonitoringDataObject = new ActiveXObject("Microsoft.XMLHTTP");
                }
                reqMonitoringDataObject.onreadystatechange = processMonitoringDataResponse;
                reqMonitoringDataObject.open("GET", "./REST_WS/" + serviceID + "/cost/total/json/tree", true);
                reqMonitoringDataObject.send(null);
            }

            function processMonitoringDataResponse() {
                if (reqMonitoringDataObject.readyState == 4) {
                    try {
                        var retrievedData = JSON.parse(reqMonitoringDataObject.responseText);
                        updateTreeView(retrievedData);

                    } catch (error) {
                        console.log("Error encountered when processing metrics");
                        window.location.href = "./index.html";
                    }
                    setTimeout(refreshMonitoringDataTreeView, 5000);
                }
            }

            refreshMonitoringDataTreeView();
        </script>
        <script type="text/javascript" >
            function refreshMonitoringDataPieView() {
                reqMonitoringDataObject = null;
                if (window.XMLHttpRequest) {
                    reqMonitoringDataObject = new XMLHttpRequest();
                } else {
                    reqMonitoringDataObject = new ActiveXObject("Microsoft.XMLHTTP");
                }
                reqMonitoringDataObject.onreadystatechange = processMonitoringDataResponse;
                reqMonitoringDataObject.open("GET", "./REST_WS/" + serviceID + "/cost/total/json/piechart", true);
                reqMonitoringDataObject.send(null);
            }

            function processMonitoringDataResponse() {
                if (reqMonitoringDataObject.readyState == 4) {
                    try {
                        var retrievedData = JSON.parse(reqMonitoringDataObject.responseText);
                        createVisualization(retrievedData);

                    } catch (error) {
                        console.log("Error encountered when processing metrics");
                        window.location.href = "./index.html";
                    }
                    setTimeout(refreshMonitoringDataTreeView, 5000);
                }
            }

            refreshMonitoringDataPieView();
            refreshMonitoringDataTreeView();
        </script>

 

    </body>
</html>
 