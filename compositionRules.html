<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
        <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
        <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <title>Mela by tuwiendsg</title>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script type="text/javascript">

            $(document).ready(function() {
                var top = $('#navibar').offset().top - parseFloat($('#navibar').css('marginTop').replace(/auto/, 100));
                $(window).scroll(function(event) {
                    // what the y position of the scroll is
                    var y = $(this).scrollTop();

                    // whether that's below the form
                    if (y >= top) {
                        // if so, ad the fixed class
                        $('#navibar').addClass('fixed');
                    } else {
                        // otherwise remove it
                        $('#navibar').removeClass('fixed');
                    }
                });
            });</script>

        <script>
            (function(i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function() {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-43025584-5', 'tuwiendsg.github.io');
            ga('send', 'pageview');

        </script>

    </head>

    <body>
        <header>
            <div class="inner">
                <h1>Documentation and Guides</h1>
                <h2>Composition rules specification</h2>
                <a href="https://github.com/tuwiendsg/MELA" class="button"><small>View project on</small>GitHub</a>
            </div>
        </header>

    <div id="horizontalNav"> 
                   <ul>
                        <li><a href="./index.html" id="homenav">Home</a></li>
                        <li><a href="./background.html" id="Background">Background</a>
                        <li><a href="./guide.html" id="guide">How does MELA work?</a>    
                            <ul>
                                <li><a href="./guide.html" >MELA Overview</a>
                                <li><a href="./compiling.html">Compiling and deployment</a></li>
                                <li><a href="./structure.html">Service structure specification</a></li>
                                <li><div id="horizontalNavCurrentNav"><a href="./compositionRules.html">Composition rules specification</a></div></li>
                                 <li><a href="./demos.html">Demos and examples</a></li>
                                <li><a href="./documentation.html">Other resources</a></li>
                            </ul>
                        </li> 
                        <li><a href="./contact.html" id="contactnav">Contact</a></li>
                    </ul>
                </div>


        <div id="content-wrapper">

            <aside id="navibar">

                <div id="nav">
                    <ul>
                        <li><a href="./index.html" id="homenav">Home</a></li>
                        <li><a href="./background.html" id="Background">Background</a>
                        <li><a href="./guide.html" id="guide">How does MELA work?</a>    
                            <ul>
                                <li><a href="./guide.html" >MELA Overview</a>
                                <li><a href="./compiling.html">Compiling and deployment</a></li>
                                <li><a href="./structure.html">Service structure specification</a></li>
                                <li><div id="currentNav"><a href="./compositionRules.html">Composition rules specification</a></div></li>
                                 <li><a href="./demos.html">Demos and examples</a></li>
                                <li><a href="./documentation.html">Other resources</a></li>
                            </ul>
                        </li> 
                        <li><a href="./contact.html" id="contactnav">Contact</a></li>
                    </ul>

                </div>
            </aside>


            <div class="inner clearfix">
                <section id="main-content">
                    
                    The second important configuration step is the specification of metric composition rules, issuing a “PUT” request towards the MELA “/metricscompositionrules” service. 
                    In Listing 2 we show a composition rule example, which applies a SUM operation over the “numberOfVMs” metric collected from all the Virtual Machine instances belonging to 
                    any Service unit, and  creates a new metric also called “numberOfVMs” which will be associated with the Service Unit for which is computed. 


                    <pre><code>&lt;CompositionRulesConfiguration&gt;
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xsi:noNamespaceSchemaLocation="compositionRules.xsd"
    &lt;MetricsCompositionRules&gt;
        &lt;CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT"&gt;
            &lt;ResultingMetric type="RESOURCE" measurementUnit="number" name="numberOfVMs"/&gt;
            &lt;Operation MetricSourceMonitoredElementLevel="VM" type="SUM"&gt;
                &lt;ReferenceMetric type="RESOURCE" name="numberOfVMs"/&gt;
            &lt;/Operation&gt;
        &lt;/CompositionRule&gt;
    &lt;/MetricsCompositionRules&gt;
&lt;/CompositionRulesConfiguration&gt;
</code></pre>

                    <p>The XML schema for writing smetrics composition rules can be downloaded from <a href="./resources/compositionRules.xsd.xsd">here</a></p>     


                    <p> A composition rule applies a set of composition operations over a set of operands. </p> 
                    <h3> Writing a Composition rule </h3>
                    <ol><li><p> For a composition rule one must first specify the “ResultingMetric”, i.e. the type (RESOURCE, COST, QUALITY), name and measurement unit of the Metric resulting from the composition rule.
                            </p><p><code>Example: &lt;ResultingMetric type="RESOURCE" measurementUnit="ms" name="avgResponseTime"/&gt;</code>
                            </p></li>
                        <li> <p>The “TargetMonitoredElementLevel” must be specified, which defines at WHICH level in the application structure level (SERVICE, SERVICE_TOPOLOGY, SERVICE_UNIT, VIRTUAL_CLUSTER, and VM) the composition rule is applied. If ONLY the “TargetMonitoredElementLevel” is specified, the composition rule will be applied to all instances having the specified level (e.g., to all SERVICE_UNIT instances)
                            </p><p><code> Example: &lt;CompositionRuleTargetMonitoredElementLevel="SERVICE_UNIT"&gt;</code> 
                            </p></li>
                        <li> <p>If a list of "TargetMonitoredElementID" are specified, this indicates particular elements from the application structure on which the composition rule will be applied.
                            </p>
                            <p><pre><code> Example: 
&lt;TargetMonitoredElementID&gt;DataControllerServiceUnit&lt;/TargetMonitoredElementID&gt;
&lt;TargetMonitoredElementID&gt;LoadBalancerServiceUnit&lt;/TargetMonitoredElementID&gt;
</code></pre></p></li>
                        <li> <p> The last element is the list of “CompositionOperation” specifications, where we define the composition operation to be applied at the specified “TargetMonitoredElementLevel” over the optionally specified “TargetMonitoredElementID”
                            </p></li>
                        <li><p>The metric resulting from applying the composition rule will be added to the monitoring data at the specified “TargetMonitoredElementLevel” and optionally specified “TargetMonitoredElementID”. If no optionally specified “TargetMonitoredElementID” are present, the metric will be added to all elements belonging to the specified level.
                            </p></li>
                    </ol>
                    <h3> Composition Operation </h3>

                    <p>
                        A Composition Operation applies an operation over one or more operands, which can be values or metrics. Depending on the operation type, each operation is processed differently.
                    </p>
                    <h4>Operands</h4>
                    <p>For a composition operation, an operand can be:
                    <ul>
                        <li> 
                            <p> A “value”: any statically defined value
                                <code>Example: &lt;Operation value="100" type="ADD"&gt; </code>
                            </p>
                        </li>
                        <li> 
                            <p> A “ReferenceMetric” , which indicates that the operation will be applied on value of the ReferenceMetric. 
                            <pre><code>Example:
     &lt;Operation MetricSourceMonitoredElementLevel="VM" type="AVG"&gt;
         &lt;ReferenceMetric type="RESOURCE" name="cpuIdle"/&gt;
     &lt;/Operation&gt;
  </code></pre>
                            </p>
                        </li>
                        <li><p>For an operation involving a “ReferenceMetric” , one must also specify the “MetricSourceMonitoredElementLevel”, which indicates at which application structure level (SERVICE, SERVICE_TOPOLOGY, SERVICE_UNIT, VIRTUAL_CLUSTER, and VM) the reference metric will be found  UNDER the monitored element over which the rule is applied. The “MetricSourceMonitoredElementLevel”  can equal the “TargetMonitoredElementLevel”, or indicate any level belonging to the children of the “TargetMonitoredElementLevel”.
                            </p>
                            <pre><code>Example:
     &lt;CompositionRule TargetMonitoredElementLevel="SERVICE_UNIT"&gt;
         &lt;Operation MetricSourceMonitoredElementLevel="VM" type="AVG"&gt;
  </code></pre>
                        </li>


                        <li><p> For defining which monitored element from the “MetricSourceMonitoredElementLevel“ is considered in extracting metric values, any number of  “SourceMonitoredElementID” can be defined.
                            </p>
                            <p>
                            <pre>
<code>
    Example:
     &lt;Operation MetricSourceMonitoredElementLevel="SERVICE_UNIT" type="KEEP"&gt;
        &lt;ReferenceMetric type="RESOURCE" measurementUnit="req/s" name="troughput"/&gt;
        &lt;SourceMonitoredElementID>LoadGenerator</SourceMonitoredElementID&gt;
        &lt;/Operation&gt;
  </code>
                            </pre></p></li>

                    </ul></p>



                    <h4>Sub-Operations</h4>
                    <p>
                        An operation can contain sub-operations, and the values returned by those sub-operations are used by the current operation, in a hierarchical manner. 

                    <pre><code>Example
     &lt;Operation value="100" type="ADD"&gt;
       &lt;Operation value="-1" type="MUL"&gt;
         &lt;Operation MetricSourceMonitoredElementLevel="VM" type="AVG"&gt;
	   &lt;ReferenceMetric type="RESOURCE" name="cpuIdle"/&gt;
         &lt;/Operation&gt;
       &lt;/Operation&gt;
     &lt;/Operation&gt;
  </code></pre></p>

                    <h4> Operation Type</h4> 
                    <p> For any operation, it is important to specify the type, as the operations are processed differently depending on their type
                    <ul>
                        <li><p>SUM:</br>
                                Intended to sum the values retrieved from a “ReferenceMetric”
                            </p><p>
                            <pre><code>Example
     &lt;CompositionRuleTargetMonitoredElementLevel="SERVICE_UNIT"&gt;
       &lt;ResultingMetric type="RESOURCE" measurementUnit="numberOf" name="numberOfVMs"/&gt;
       &lt;Operation MetricSourceMonitoredElementLevel="VM" type="SUM"&gt;
         &lt;ReferenceMetric type="RESOURCE" name="numberOfVMs"/&gt;
       &lt;/Operation&gt;
     &lt;/CompositionRule&gt;
   </code></pre></p></li>
                        <li><p>AVG:</br>
                                Applied similar to SUM, extracts the average.
                            </p></li>
                        </li>
                        <li>
                            <p> MAX / MIN: </br>
                                Applied similar to SUM, extracts the maximum or minimum value.</p></li>

                        <li><p> DIV/MUL/ADD/SUB: </br>
                                Divide, Multiply, Subtract From, Add To, the value of the first operand the value of the second operand</p>
                            <p>
                            <pre><code>Example
     &lt;Operation value="-1" type="MUL"&gt;
         &lt;Operation MetricSourceMonitoredElementLevel="VM" type="AVG"&gt;
           &lt;ReferenceMetric type="RESOURCE" name="cpuIdle"/&gt;
         &lt;/Operation&gt;
     &lt;/Operation&gt; 
 </code></pre>  </p></li>
                        <li><p>SET_VALUE</br> 
                                Used in creating metric values</p>
                            <p><pre><code>Example
     &lt;CompositionRuleTargetMonitoredElementLevel="VM"&gt;
     &lt;ResultingMetric type="RESOURCE" measurementUnit="ms" name="numberOfVMs"/&gt;
       &lt;Operation value="1" type="SET_VALUE"/&gt;
     &lt;/CompositionRule&gt;
 </code></pre><p></li> 
                        <li>CONCAT</li>
                        <li>UNION</li>
                        <li>KEEP/ KEEP_LAST/ KEEP_FIRST</li>
                    </ul>
                    </p>

                    For detailed information from deployment to configuring MELA for specific elastic services, check:
                    <ul><li><a href="./compiling.html">Compiling and deployment</a></li>
                        <li><a href="./structure.html">Service structure specification</a></li>
                        <li><a href="./compositionRules.html">Composition rules specification</a></li>
                    </ul>
                </section>


<aside id="sidebar">
                    <a href="http://www.tuwien.ac.at/" class="button" style="background: url(./images/TU_logo.png) 0 0 no-repeat; height:70px;  width:300px">
                    </a>

                    <a href="http://www.infosys.tuwien.ac.at/" class="button" style="background: url(./images/dsgComplet.png) 0 0 no-repeat; background-size:100%; width:300px; height:70px">
                    </a>

                    <p class="repo-owner" style="width:300px"><a href="https://github.com/tuwiendsg/MELA"></a> Maintained and distributed by <a href="http://www.infosys.tuwien.ac.at/staff/dmoldovan/"> Daniel Moldovan </a>
                        </br> </br><a href="http://www.infosys.tuwien.ac.at/">Distributed Systems Group</a>
                        , <a href="http://www.tuwien.ac.at/">Vienna University of Technology</a>.</p>
                </aside>


                <aside id="sidebar">
                    <a href="https://github.com/tuwiendsg/MELA/zipball/master" class="button">
                        <small>Download</small>
                        .zip file
                    </a>
                    <a href="https://github.com/tuwiendsg/MELA/tarball/master" class="button">
                        <small>Download</small>
                        .tar.gz file
                    </a>

                    <p class="repo-owner"><a href="https://github.com/tuwiendsg/MELA"></a> is maintained by <a href="https://github.com/tuwiendsg">tuwiendsg</a>.</p>

                </aside>



            </div>
        </div>


    </body>
</html>
